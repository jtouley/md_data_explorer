---
description: Active development session
globs: []
alwaysApply: true
---

# Active Session: multi-table-semantic-layer-fix

## Session File
.context/sessions/multi-table-semantic-layer-fix.yaml

## Resume Prompt
Resume session: multi-table-semantic-layer-fix

Problem: When uploading multi-table ZIP files (e.g., MIMIC-IV), only the unified cohort table was being registered in the semantic layer, not the individual tables.

Completed:
1. Modified save_zip_upload() in user_datasets.py to save individual tables to {upload_id}_tables/ directory
2. Modified _maybe_init_semantic() in uploaded/definition.py to register all individual tables in DuckDB

Remaining:
1. Fix list_uploads() to deduplicate by dataset_name (keep most recent upload)
   - Current issue: When re-uploading with same dataset_name, old upload is used because dictionary overwrites with oldest entry
   - Solution: Add deduplication logic to list_uploads() method

Apply the deduplication fix to list_uploads() in src/clinical_analytics/ui/storage/user_datasets.py
